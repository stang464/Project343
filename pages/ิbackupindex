<template>
  <v-container>
    <v-row justify="center" align="center">
      <v-col cols="12" lg="8" md="6">
        <v-row>
          <v-text-field
            label="ค้นหา"
            placeholder="Placeholder"
            v-model="text"
            solo
          ></v-text-field>
          <v-btn @click="search" class="mx-2" fab dark color="error">
            <v-icon dark> mdi-magnify </v-icon>
          </v-btn>
        </v-row>
      </v-col>
    </v-row>
    <v-row>
      <v-container fluid>
        <v-row dense>
          <v-col v-for="(list, index) in res" :key="index" cols="12">
            <v-card>
              <v-img
                :src="list.img[0]"
                class="white--text align-end"
                gradient="to bottom, rgba(0,0,0,.1), rgba(0,0,0,.5)"
                height="200px"
              >
                <nuxt-link
                  :to="{ name: 'post-id', params: { id: list.name } }"
                  active-class="my-custom-exact-active-link"
                  ><v-card-title v-text="list.name"></v-card-title
                ></nuxt-link>
              </v-img>

              <v-card-actions>
                <v-rating
                  v-model="list.rating"
                  color="yellow accent-4"
                  readonly
                  half-increments
                ></v-rating>
                <v-spacer></v-spacer>

                <v-menu top :close-on-click="closeOnClick">
                  <template v-slot:activator="{ on, attrs }">
                    <v-btn
                      color="primary"
                      icon
                      dark
                      v-bind="attrs"
                      v-on="on"
                      @click="genlink(index)"
                    >
                      <v-icon>mdi-share-variant</v-icon>
                    </v-btn>
                  </template>

                  <v-list>
                    <v-list-item>
                      <ShareNetwork
                        network="facebook"
                        :url="`https://project-cs343-cs313.web.app/post/${link}`"
                        :title="list.name"
                      >
                        Facebook
                      </ShareNetwork>
                    </v-list-item>
                    <v-list-item>
                      <ShareNetwork
                        network="twitter"
                        :url="`https://project-cs343-cs313.web.app/post/${link}`"
                        :title="list.name"
                      >
                        Twitter
                      </ShareNetwork>
                    </v-list-item>
                  </v-list>
                </v-menu>
                <v-btn icon @click="getfev(), addfev(index)">
                  <v-icon>mdi-bookmark</v-icon>
                </v-btn>
              </v-card-actions>
            </v-card>
          </v-col>
        </v-row>
      </v-container>
    </v-row>
    <div v-show="not"></div>
  </v-container>
</template>


getfev() {
      if (this.login === false) {
        var email = null;
        email = this.userdata;
        email = email[0].email;
        db.collection("User")
          .where("email", "==", email)
          .onSnapshot((querySnapshot) => {
            /* eslint no-var: */
            var data = [];
            var tmp = [];
            querySnapshot.forEach((doc) => {
              data.push(doc.data());
              for (var i in data[0].favorite) {
                tmp[i] = data[0].favorite[i];
              }
              this.faver = tmp;
            });
          });
      }
    },
    addfev(index) {
      if (this.login === false) {
        var email = this.userdata[0].email;
        var tmp = this.userdata[0].favorite;
        var data = this.res[index].name;
        tmp.push(data);
        tmp = tmp.filter(function (elem, index, self) {
          return index === self.indexOf(elem);
        });
        tmp = { favorite: tmp };
        db.collection("User")
          .doc(email)
          .update(tmp)
          .then(function () {
            alert("เพิ่มร้านโปรด");
          });
      } else {
        this.$router.push("/SignIn");
      }
    },